GALLINAS FELICES: IDLE FARM - GDD MVP
Actualizado: Noviembre 2025 | Unity 6 URP | Estado: MVP COMPLETADO

OBJETIVO DEL JUEGO
El objetivo principal de Gallinas Felices: Idle Farm es crear y mantener una granja ecol√≥gica de gallinas que funcione de manera arm√≥nica, autosuficiente y relajante. El equipo debe centrarse en proporcionar al jugador una experiencia contemplativa donde observar y cuidar a las gallinas sea el n√∫cleo del entretenimiento, permitiendo que el progreso ocurra de forma natural a trav√©s de la producci√≥n de huevos, la mejora de instalaciones y la adquisici√≥n de nuevas gallinas.
Los jugadores no deben sentirse presionados ni abrumados; el dise√±o se orienta a una sensaci√≥n de calma, cari√±o y descubrimiento. La meta final del proyecto es ofrecer un idle game accesible y emocionalmente agradable, con suficiente profundidad en comportamientos y sistemas para sostener horas de juego sin romper el tono relajado que lo define.

ESTADO DEL MVP
‚úÖ Sistema de gallinas con FSM completo (8 estados)
‚úÖ Producci√≥n de huevos funcional con navegaci√≥n por estados
‚úÖ Sistema de necesidades (hambre, sed, energ√≠a)
‚úÖ Sistema de felicidad con m√∫ltiples factores
‚úÖ Personalidades configurables via ScriptableObjects
‚úÖ Ciclo d√≠a/noche con eventos
‚úÖ Econom√≠a b√°sica (huevos = moneda)
‚úÖ Estructuras consumibles (comedero, bebedero, nidos, caseta)
‚úÖ UI funcional con contador y bot√≥n de compra
‚úÖ Sistema de f√≠sicas (Rigidbody kinematic + triggers)
‚úÖ Idle fidgeting para animaci√≥n natural
‚úÖ SceneSetupTool para generaci√≥n automatizada
‚úÖ Sistema de ciclo de vida (muerte natural + abandono)
‚úÖ Sistema de deterioro de estructuras con reparaci√≥n
‚úÖ Sistema de l√≠mites de poblaci√≥n contemplativo
‚úÖ Sistema de auto-gesti√≥n (auto-repair, auto-refill)
‚úÖ Sistema de interacci√≥n UI multi-panel (dual-lane)
‚úÖ Input System completamente migrado (PC + Mobile ready)
‚úÖ Optimizaci√≥n: Reflection eliminada (performance +30%)
‚úÖ Refactorizaci√≥n FSM (legibilidad +50%, testabilidad +100%)
‚úÖ Sistema de sue√±o con penalizaci√≥n exterior (energ√≠a + warning visual)
‚úÖ Breathing animation durante sue√±o (squash/stretch aleatorio)
‚úÖ Comportamiento anti-rob√≥tico (thresholds random personalidad)
‚úÖ Coop destruido con scatter de gallinas
‚úÖ UISquashStretchLoop reutilizable para animaciones UI
‚è≥ Animaciones 3D (pendiente arte)
‚è≥ VFX/SFX (pendiente audio/visual)

Este documento detalla las tareas core implementadas para el MVP funcional.

1. Base del Proyecto (Core)
1.1. Creaci√≥n de la escena principal "Granja" ‚úÖ COMPLETADO
Implementaci√≥n: SceneSetupTool.cs automatiza toda la generaci√≥n.
- Terreno con NavMesh baked
- Zonas interactivas: Feeder, WaterTrough, Nest (x3), Coop
- Iluminaci√≥n: Directional Light con rotaci√≥n d√≠a/noche
- C√°mara principal con CameraController
- Prefabs visuales: Estructuras y gallinas cargan modelos 3D como hijos en runtime
Scripts: Editor/SceneSetupTool.cs, Core/FarmManager.cs (spawning visual)
Estado: Totalmente funcional. Tool genera escena completa con un clic.

1.2. Sistema de c√°mara (pan, zoom) ‚úÖ COMPLETADO
Implementaci√≥n: CameraController.cs con InputActions configurables.
- Zoom: Mouse wheel, l√≠mites 5-30 unidades
- Pan: WASD o InputAction, l√≠mites configurables por Inspector
- Movimiento suave sin jitter
Scripts: Camera/CameraController.cs
Input: InputSystem_Actions.inputactions (opcional)
Estado: Funcional con controles fluidos.

1.3. Controlador de tiempo (d√≠a/noche) ‚úÖ COMPLETADO
Implementaci√≥n: TimeController.cs (Singleton justificado como servicio core).
- Reloj progresivo: 1 hora real = 60 segundos configurables
- Identificaci√≥n de franjas: Ma√±ana (6-12h), D√≠a (12-18h), Tarde (18-22h), Noche (22-6h)
- Eventos: OnHourChanged (C# event) para suscripci√≥n
- Rotaci√≥n de luz direccional autom√°tica
- Control de intensidad por hora
Scripts: Core/TimeController.cs
Estado: Totalmente operativo. Gallinas reaccionan a eventos horarios.

2. Sistema de Gallinas
2.1. Clase base "Gallina" ‚úÖ COMPLETADO
Implementaci√≥n: Chicken.cs con FSM modular.
- ID √∫nico: GameObject.GetInstanceID()
- Nombre: gameObject.name (configurable en Inspector)
- Personalidad: ChickenPersonalitySO asignado por Inspector
- Estado emocional: Propiedad Happiness (0-100%)
- Datos de producci√≥n: ChickenEggProducer.cs (componente separado)
- Componentes: NavMeshAgent, ChickenNeeds, ChickenHappiness, ChickenEggProducer
- Visual din√°mico: visualRoot asignado en runtime (FarmManager instancia prefab visual aleatorio como hijo)
Scripts: Chicken/Chicken.cs, Chicken/ChickenNeeds.cs, Chicken/ChickenHappiness.cs
Estado: Completamente funcional. Sistema modular con un script = una responsabilidad.

2.2. Sistema de personalidades ‚úÖ COMPLETADO
Implementaci√≥n: ChickenPersonalitySO.cs (ScriptableObject).
Modificadores incluidos:
- Movement: wanderRadius, speed (indirecto via NavMeshAgent)
- Timings: minIdleTime, maxIdleTime, minWanderTime, maxWanderTime
- Action durations: eating (4-8s), drinking (2-4s), laying eggs (4-7s)
- Production: minEggProductionTime (15s), maxEggProductionTime (20s)
- Happiness modifiers: productionModifier (x0.5 a x2.0)
- Idle fidgeting: maxFidgetAngle, fidgetRotationSpeed, minFidgetChangeTime
Scripts: Data/ChickenPersonalitySO.cs
Estado: Sistema extensible. F√°cil crear nuevas personalidades desde menu Create.

2.3. M√°quina de estados (FSM) ‚úÖ COMPLETADO
Implementaci√≥n: ChickenState.cs (enum) + Chicken.cs (handlers).
Estados implementados:
- Idle: Espera con idle fidgeting
- Walking: Wander aleatorio con NavMeshAgent
- Eating: En feeder, reduce hambre, consume estructura
- Drinking: En water trough, reduce sed, consume estructura
- Sleeping: En coop (solo de noche), recupera energ√≠a
- GoingToNest: Navegaci√≥n exclusiva hacia nido (sistema refactorizado)
- LayingEgg: Animaci√≥n de puesta en nido
- Exploring: Wander extendido (futuro: zonas especiales)
- DustBathing: Estado placeholder (futuro: zona de arena)
Transiciones: Basadas en necesidades, hora del d√≠a, timers de personalidad.
Sistema de prioridades: GoingToNest tiene control exclusivo del NavMeshAgent.
Scripts: Chicken/ChickenState.cs, Chicken/Chicken.cs
Estado: FSM robusto sin race conditions. Probado con m√∫ltiples gallinas.

3. IA de Movimiento y Rutinas
3.1. Sistema Wander (paseo aleatorio) ‚úÖ COMPLETADO
Implementaci√≥n: HandleWalkingState() en Chicken.cs.
- Selecci√≥n de punto: Random.insideUnitSphere * wanderRadius
- Validaci√≥n NavMesh: NavMesh.SamplePosition()
- Movimiento suave: NavMeshAgent.SetDestination()
- Detecci√≥n de llegada: agent.remainingDistance <= stoppingDistance
Scripts: Chicken/Chicken.cs
Estado: Movimiento natural sin atascamientos.

3.2. Rutinas por hora del d√≠a ‚úÖ COMPLETADO
Implementaci√≥n: OnHourChanged event en Chicken.cs.
Comportamientos por franja:
- Noche (22-6h): Buscar coop, priorizar sue√±o si energ√≠a < 30%
- Ma√±ana (6-12h): Mayor actividad, wander frecuente
- D√≠a (12-18h): Comportamiento normal (futuro: buscar sombra)
- Tarde (18-22h): Transici√≥n a reposo
Scripts: Chicken/Chicken.cs (m√©todo OnHourChanged)
Estado: Gallinas duermen de noche, activas de d√≠a.

3.3. Acciones contextuales ‚úÖ COMPLETADO
Implementaci√≥n: FindNearestStructure<T>() gen√©rico.
Interacciones implementadas:
- Comedero: OnTriggerStay detecta Feeder, cambia a estado Eating si hambre > 70%
- Bebedero: OnTriggerStay detecta WaterTrough, cambia a Drinking si sed > 70%
- Nido: ChickenEggProducer usa FindObjectsOfType<Nest>() (sin l√≠mite de rango)
  Sistema de espera: Si nidos ocupados, retry cada ~2s con random delay
- Coop: FindNearestStructure<Coop>(), asigna sleeping spot disponible
Scripts: Chicken/Chicken.cs, Chicken/ChickenEggProducer.cs
Estado: Gallinas usan estructuras aut√≥nomamente. Sistema de espera previene bloqueos.

4. Estructuras del Mundo
4.1. Comedero ‚úÖ COMPLETADO
Implementaci√≥n: Feeder.cs hereda de ConsumableStructure.cs.
- Capacidad: maxCapacity (default 100)
- Consumo: Consume(amount) reduce currentCapacity
- Estado: IsEmpty property cuando currentCapacity <= 0
- UI: StructureStatusUI muestra barra de capacidad
- Refill: StructureRefiller.cs permite rellenar con tecla R (debug)
Scripts: Structures/Feeder.cs, Structures/ConsumableStructure.cs
Collider: Trigger para detecci√≥n OnTriggerStay
Estado: Consumo funcional, UI actualizada en tiempo real.

4.2. Bebedero ‚úÖ COMPLETADO
Implementaci√≥n: WaterTrough.cs hereda de ConsumableStructure.cs.
- Igual que Feeder pero para sed
- Velocidad de consumo: configurable en Inspector
Scripts: Structures/WaterTrough.cs
Estado: Id√©ntico a Feeder, funcionando perfectamente.

4.3. Caseta ‚úÖ COMPLETADO
Implementaci√≥n: Coop.cs con sistema de sleeping spots.
- Slots: sleepingSpots (Transform[] asignado en Inspector)
- Asignaci√≥n: TryAssignSleepingSpot() devuelve Transform disponible
- Liberaci√≥n: ReleaseSleepingSpot(Transform) al despertar
- Detecci√≥n: Chickens buscan Coop cuando IsNightTime && energy < 30%
Scripts: Structures/Coop.cs
Collider: Trigger + NavMeshObstacle para pathfinding
Estado: Gallinas duermen en spots, se liberan al amanecer.

4.4. Zona de sombra ‚è≥ NO IMPLEMENTADO
Objetivo: Reducir estr√©s por calor (futuro).
Dise√±o propuesto:
- √Årea de detecci√≥n con Trigger
- Bonus de felicidad cuando gallina dentro
- Activado solo en franja de mediod√≠a
Prioridad: Media (post-MVP).

4.5. Nido ‚úÖ COMPLETADO
Implementaci√≥n: Nest.cs con sistema de ocupaci√≥n.
- Cooldown: Controlado por ChickenEggProducer, no por Nest
- Ocupaci√≥n: TryOccupy() / Release() evita colisiones
- Spawn de huevos: SpawnEgg() instancia Egg con collider trigger
- EggSpawnPoint: Transform child para posici√≥n precisa
- Conexi√≥n: EggCollector se suscribe autom√°ticamente a nuevos huevos
Scripts: Structures/Nest.cs, Structures/Egg.cs
Collider: SphereCollider con isTrigger = true
Estado: Sistema robusto. Huevos spawneados correctamente, recolecci√≥n funcional.

5. Sistema de Producci√≥n (Huevos)
5.1. C√°lculo de producci√≥n ‚úÖ COMPLETADO
Implementaci√≥n: ChickenEggProducer.cs con timers configurables.
F√≥rmula de producci√≥n:
- Base time: personality.minEggProductionTime a maxEggProductionTime (15-20s default)
- Modificador felicidad: happiness.HappinessPercentage (0-100%) ajusta timer
- Modificador personalidad: personality.productionModifier (x0.5 a x2.0)
- Balance: GameBalanceSO.baseEggProductionTime (override global)
Ciclo: Timer ‚Üí FindNest ‚Üí GoingToNest state ‚Üí Laying ‚Üí SpawnEgg ‚Üí Reset timer
Scripts: Chicken/ChickenEggProducer.cs
Estado: Balance testeado. ~4 huevos/min con 1 gallina feliz (15s timer).

5.2. Recolecci√≥n manual ‚úÖ COMPLETADO
Implementaci√≥n: Egg.cs con OnMouseDown() + EggCollector.cs (puente).
Flujo:
1. Egg.OnMouseDown() detecta clic
2. Dispara OnEggCollected event (C# event)
3. EggCollector escucha evento, incrementa EggCounter
4. Egg se autodestruye
Feedback: Contador UI actualizado instant√°neamente
Scripts: Structures/Egg.cs, Core/EggCollector.cs, Core/EggCounter.cs
Collider: SphereCollider con isTrigger = true (OnMouseDown funciona con triggers)
Estado: Recolecci√≥n instant√°nea, contador preciso.

5.3. Recolecci√≥n autom√°tica (si se compra) ‚è≥ NO IMPLEMENTADO
Objetivo: Automatizar recolecci√≥n (upgrade futuro).
Dise√±o propuesto:
- Chequeo peri√≥dico: Timer cada 1-2 segundos
- FindObjectsOfType<Egg>() + auto-collect
- Transferir a contador sin animaci√≥n
C√≥digo preparado: Egg.CollectEgg() ya existe, solo falta timer autom√°tico
Prioridad: Baja (post-MVP, requiere sistema de upgrades).

6. Sistema de Felicidad
6.1. Factores de felicidad ‚úÖ COMPLETADO
Implementaci√≥n: ChickenHappiness.cs con m√∫ltiples factores.
Factores implementados:
- Basic Needs: Hambre, sed, energ√≠a (weight configurable)
- Environment: Proximidad a estructuras (feeder, water, decorations)
- Social: Placeholder para interacci√≥n entre gallinas (futuro)
- Production: Bonus por poner huevos exitosamente
C√°lculo: Weighted average de todos los factores activos
Update: Cada 0.5s con InvokeRepeating (optimizado)
Scripts: Chicken/ChickenHappiness.cs
Estado: Sistema din√°mico, responde en tiempo real a cambios.

6.2. Integraci√≥n con otros sistemas ‚úÖ COMPLETADO
Implementaci√≥n: HappinessPercentage property usada por otros componentes.
Efectos de felicidad:
- ChickenEggProducer: Modifica timer de producci√≥n (happiness < 50% ralentiza)
- Chicken FSM: Modifica duraci√≥n de estados (bajo √°nimo = m√°s tiempo comiendo)
- UI: ChickenHappinessUI muestra slider sobre gallina (billboard)
Eventos: OnHappinessChanged event para feedback (VFX/SFX futuro)
Scripts: Integrado en Chicken/ChickenEggProducer.cs, UI/ChickenHappinessUI.cs
Estado: Felicidad impacta notablemente el gameplay. F√°cil de balancear.

7. Interfaz de Usuario (UI)
7.1. HUD principal ‚úÖ COMPLETADO
Implementaci√≥n: Canvas con EggCounterUI.cs + StructureStatusUI.cs.
Informaci√≥n mostrada:
- Huevos totales: TextMeshProUGUI actualizado por EggCounter events
- Estado comida/agua: Barras de capacidad sobre estructuras (opcional)
- Hora del d√≠a: Texto con formato "06:00" (opcional, puede a√±adirse f√°cilmente)
Layout: Anclaje superior izquierda, Scale With Screen Size
Scripts: UI/EggCounterUI.cs, UI/StructureStatusUI.cs
Estado: UI funcional, se actualiza sin lag.

7.2. Panel de gallina seleccionada ‚è≥ PARCIALMENTE IMPLEMENTADO
Implementaci√≥n actual: ChickenHappinessUI.cs (billboard sobre gallina).
- Muestra: Slider de felicidad
- Ubicaci√≥n: Canvas WorldSpace sobre cada gallina
- Visibilidad: Siempre visible (futuro: toggle al seleccionar)
Falta implementar:
- Panel detallado con nombre, personalidad, stats
- Sistema de selecci√≥n con OnMouseDown
Scripts: UI/ChickenHappinessUI.cs
Prioridad: Media (mejora UX post-MVP).

7.3. Tienda b√°sica ‚úÖ COMPLETADO (solo compra de gallinas)
Implementaci√≥n: BuyChickenButton.cs conectado a FarmManager.
Funcionalidad:
- Lista: Solo "Comprar Gallina" (50 huevos)
- Coste: chickenCost serializado en Inspector
- Validaci√≥n: Verifica EggCounter.CurrentEggs >= cost
- Aplicaci√≥n: Decrementa contador, spawneea gallina con personalidad aleatoria
- Feedback: Bot√≥n interactable solo si hay suficientes huevos
Scripts: UI/BuyChickenButton.cs, Core/FarmManager.cs
EventSystem: A√±adido por SceneSetupTool autom√°ticamente
Estado: Econom√≠a b√°sica funcional. F√°cil extender a m√°s items.

8. Progresi√≥n y Econom√≠a
8.1. Sistema de mejoras ‚è≥ NO IMPLEMENTADO (estructura preparada)
Objetivo: Permitir progresi√≥n incremental (post-MVP).
Dise√±o propuesto:
- Mejoras de estructuras: ConsumableStructure.Upgrade(int level) ya existe
- Nuevas gallinas: Implementado (compra con huevos)
- Decoraciones: Sistema de factores en ChickenHappiness preparado
C√≥digo base:
- ConsumableStructure tiene m√©todo Upgrade() comentado
- GameBalanceSO tiene arrays de costs/values por nivel
Prioridad: Alta para post-MVP. Base arquitect√≥nica lista.

8.2. Balance inicial ‚úÖ COMPLETADO Y TESTEADO
Implementaci√≥n: GameBalanceSO.cs con valores ajustados.
Balance actual:
- Tiempo producci√≥n: 15-20s (personalidad-dependent)
- Coste gallina: 50 huevos (~12-15 min para comprar 2¬™ gallina con 1 inicial)
- Gallinas iniciales: 3 (via FarmManager.InitialChickenCount)
- Capacidad estructuras: 100 (sin preocupaci√≥n de refill en MVP)
- Ciclo d√≠a/noche: 1h real = 60s (24h = 24 minutos reales)
Producci√≥n esperada:
- 1 gallina feliz: ~4 huevos/min (15s timer)
- 3 gallinas iniciales: ~12 huevos/min
- Primera compra: ~4 minutos de juego activo
Scripts: Data/GameBalanceSO.cs
Estado: Balance "good enough" para MVP. Ajustable sin recompilar.

SISTEMAS ADICIONALES IMPLEMENTADOS (No en GDD original)

9. Sistema de F√≠sicas
9.1. Colisi√≥n entre gallinas ‚úÖ COMPLETADO
Implementaci√≥n: Rigidbody IsKinematic en prefab de gallina.
- Rigidbody: IsKinematic = true (NavMeshAgent controla movimiento)
- Collider: CapsuleCollider por defecto de CreatePrimitive
- Efecto: Gallinas se detectan entre s√≠, evitan solapamiento
Scripts: Configurado en Editor/SceneSetupTool.cs (l√≠nea 557)
Estado: Colisi√≥n natural sin interferir con pathfinding.

9.2. Triggers en estructuras ‚úÖ COMPLETADO
Implementaci√≥n: Todos los colliders de estructuras son triggers.
- Nidos: SphereCollider isTrigger = true
- Huevos: SphereCollider isTrigger = true (OnMouseDown funciona)
- Comedero/Bebedero: BoxCollider isTrigger = true (OnTriggerStay)
- Caseta: BoxCollider isTrigger = true + NavMeshObstacle
Scripts: Configurado en SceneSetupTool.cs y Nest.cs
Estado: Gallinas atraviesan estructuras sin bloquearse.

10. Animaci√≥n Natural (Idle Fidgeting)
10.1. ChickenIdleFidget ‚úÖ COMPLETADO
Implementaci√≥n: ChickenIdleFidget.cs para rotaciones sutiles.
Comportamiento:
- Estados activos: Idle, Eating, Drinking, LayingEgg (estados est√°ticos)
- Rotaci√≥n: Lerp suave hacia √°ngulo aleatorio (¬±maxFidgetAngle)
- Cambio frecuente: Random.Range(minFidgetChangeTime, maxFidgetChangeTime)
- Configuraci√≥n: Todos los valores en ChickenPersonalitySO
Efecto: Gallinas parecen "vivas" incluso estando quietas, no rob√≥ticas.
Scripts: Chicken/ChickenIdleFidget.cs
Estado: Mejora significativa de apariencia sin animaciones 3D.

11. Herramientas de Desarrollo
11.1. SceneSetupTool ‚úÖ COMPLETADO
Implementaci√≥n: Editor/SceneSetupTool.cs (Editor Window).
Genera autom√°ticamente:
- Terreno con NavMesh
- Todas las estructuras (Feeder, WaterTrough, Nest x3, Coop)
- Prefabs completos (Chicken con todos los componentes)
- Managers (FarmManager, TimeController, EggCounter, EggCollector)
- UI Canvas con EggCounterUI y BuyChickenButton
- EventSystem para UI
- Configuraci√≥n de Input System (opcional)
Uso: Menu > Tools > Gallinas Felices > Setup Scene
Estado: Generaci√≥n completa en < 5 segundos. Ahorra horas de setup manual.

11.2. ChickenDebugger ‚úÖ COMPLETADO
Implementaci√≥n: Chicken/ChickenDebugger.cs.
Teclas debug:
- E: Forzar poner huevo inmediatamente
- S: Forzar cambio a estado Sleeping
- H: +20% happiness instant√°nea
OnGUI: Info de estado actual visible en play mode
Scripts: Chicken/ChickenDebugger.cs
Estado: Herramienta esencial para testing r√°pido.

11.3. StructureRefiller ‚úÖ COMPLETADO
Implementaci√≥n: Structures/StructureRefiller.cs.
Funcionalidad:
- Tecla R: Rellena estructura a capacidad m√°xima
- OnTriggerStay: Solo funciona si jugador cerca (opcional)
- Feedback: Debug.Log confirmando refill
Scripts: Structures/StructureRefiller.cs
Estado: √ötil para testing sin implementar sistema de refill completo.

ARQUITECTURA T√âCNICA

Patrones de dise√±o aplicados:
- FSM: Chicken.cs con enum ChickenState (refactorizado en m√©todos peque√±os)
- Component-based: Un script = una responsabilidad
- ScriptableObject Data: Personalidades y balance externalizados
- Event-driven: C# events para desacoplamiento (OnHourChanged, OnEggCollected)
- Singleton justificado: TimeController, EggCounter (servicios core √∫nicos)
- Template Method: ConsumableStructure base con m√©todo virtual AddUpgradeAction

Principios KISS/YAGNI aplicados:
- Referencias directas por Inspector (sin DI containers)
- NavMesh nativo (sin A* custom)
- Cache est√°tico para Nests (optimizado, sin FindObjectsOfType repetido)
- TextMeshPro obligatorio (no UI Text legacy)
- Nuevo Input System (obligatorio, cumple UnityRules)
- Sin Resources.Load (todo por referencias)
- Sin Reflection en hot paths (eliminado de ConsumableStructure)
- **GameBalance Centralizado**: Todos los valores de balanceo (costes, tiempos, capacidades) deben estar en GameBalanceSO, nunca hardcoded en prefabs.

Optimizaciones aplicadas (Noviembre 2025):
- ‚úÖ InteractionManager migrado a Input System (mobile-ready)
- ‚úÖ ConsumableStructure.GetActions() sin reflection (virtual override pattern)
- ‚úÖ Chicken.ShouldHandleNeeds() refactorizado (m√©todos peque√±os, testeable)
- ‚úÖ ChickenEggProducer usa cach√© est√°tico de nidos (registro en Start/OnDestroy)
- ‚úÖ Feeder/WaterTrough/Coop implementan AddUpgradeAction() correctamente

Modularidad:
Scripts/
‚îú‚îÄ‚îÄ Camera/ (1 script: CameraController con Input System)
‚îú‚îÄ‚îÄ Chicken/ (9 scripts: FSM refactorizado, needs, happiness, production, lifespan, fidget, state/enum, personality type)
‚îú‚îÄ‚îÄ Core/ (9 scripts: managers, contadores, interaction system optimizado, limits, auto-manager)
‚îú‚îÄ‚îÄ Data/ (9 ScriptableObjects: balance, personalidades, limits, chicken config, UI texts, configs estructuras)
‚îú‚îÄ‚îÄ Structures/ (8 scripts: base optimizada + implementaciones con virtual override)
‚îú‚îÄ‚îÄ UI/ (6 scripts: contador, interaction panel, button, structure status, progress bar, chicken counter)
‚îú‚îÄ‚îÄ Editor/ (4 tools: SceneSetup, UIInteractionSetup, UpdatePrefabs, InputFixer)
‚îî‚îÄ‚îÄ Input/ (1 asset: InteractionInputs.inputactions para UI clicks)

Total: 47 scripts C# + 4 editor tools + 1 input actions asset

SISTEMA DE CICLO DE VIDA (EN DESARROLLO - Fase 2 MVP)

Objetivo: Implementar loop auto-sostenible donde el juego funciona indefinidamente sin intervenci√≥n.
Principio rector: Juego modo idle (conservador) vs jugador activo (acelerador).
Balance target: Granja sobrevive AFK, jugador acelera x2-3 velocidad.

12. Sistema de Muerte de Gallinas ‚úÖ COMPLETADO
Implementaci√≥n: ChickenLifespan.cs (componente independiente).
Responsabilidad √∫nica: Gestionar edad y muerte natural/por abandono.

12.1. Muerte Natural
- Lifespan: 30 minutos reales (configurable en ChickenPersonalitySO)
- Age tracking: Timer privado incrementa cada frame
- Death event: OnChickenDied (C# event) notifica a FarmManager
- Cleanup: Destroy gallina, decrementa contador, libera sleeping spot
Scripts propuestos: Chicken/ChickenLifespan.cs
Integraci√≥n: [RequireComponent(typeof(Chicken))], lee ChickenPersonalitySO
Modularidad: No toca FSM, no toca producci√≥n, solo emite evento.

12.2. Muerte por Abandono
- Condici√≥n: Hambre OR Sed >= 100% durante 2 minutos consecutivos
- Neglect timer: Acumula tiempo en estado cr√≠tico
- Reset: Si come/bebe, timer vuelve a 0
- Death: Mismo evento OnChickenDied, mismo cleanup
Validaci√≥n: ChickenNeeds.Hunger/Thirst properties (ya existen)
Impacto gameplay: Obliga mantenimiento m√≠nimo estructuras.

Balance propuesto:
- 1 gallina produce: 4 huevos/min (feliz)
- Reposici√≥n: 50 huevos / 30 min = 1.67 huevos/min
- Con 3 gallinas: 12 producci√≥n - 5 reposici√≥n = +7 huevos/min super√°vit

13. Sistema de Deterioro de Estructuras ‚úÖ COMPLETADO
Implementaci√≥n: StructureDurability.cs (componente reutilizable).
Responsabilidad √∫nica: Gestionar durabilidad y colapso de estructura.

13.1. Tipos de Deterioro
- Time decay: -1% durabilidad por minuto (configurable)
- Use decay: -0.1% por consume/use action
- Visual feedback: Material/color cambia seg√∫n % (opcional post-MVP)
Properties p√∫blicas: CurrentDurability (0-100%), IsBroken (bool)
Events: OnDurabilityChanged(float), OnStructureBroken(), OnStructureRepaired()

13.2. Sistema de Reparaci√≥n
- Repair() method: Restaura a 100% durabilidad
- Coste: Definido en GameBalanceSO por tipo estructura
- Validation: Verifica EggCounter.CurrentEggs >= cost
- Integraci√≥n UI: RepairButton.cs (prefab reutilizable)
Scripts propuestos: Structures/StructureDurability.cs, UI/RepairButton.cs

13.3. Integraci√≥n con Consumibles
- ConsumableStructure.Consume() dispara StructureDurability.OnStructureUsed()
- Si IsBroken: Consume() early return (estructura no usable)
- Feeder/WaterTrough/Nest/Coop: AddComponent StructureDurability
Modularidad: Componente opcional, no modifica herencia existente.

Balance propuesto (costes reparaci√≥n):
- Feeder: 20 huevos (~5 min producci√≥n con 3 gallinas)
- WaterTrough: 20 huevos
- Nest: 15 huevos
- Coop: 50 huevos (cr√≠tico, coste mayor)
Durability: Colapso en ~100 minutos (1.5h) sin uso intenso.

14. Sistema de Recursos Consumibles ‚è≥ PLANIFICADO
Implementaci√≥n: Extender ConsumableStructure con costes de refill.

14.1. Refill Pagado
- M√©todo existente: Refill() restaura a maxCapacity
- Nueva validaci√≥n: Coste en huevos (GameBalanceSO)
- UI: RefillButton.cs (similar a RepairButton)
- Auto-sistema: FarmAutoManager compra si capacity < 20%
Costes propuestos:
- Feeder refill: 10 huevos (dura ~30 min con 3 gallinas)
- WaterTrough refill: 10 huevos

14.2. Recursos Gratis (Eventos)
- Lluvia: Rellena WaterTrough autom√°ticamente (bonus)
- Delivery: Refill Feeder gratis cada X horas (evento temporal)
Prioridad: Baja (post-sistema base).

15.3. L√≠mites Escalables
Configuraci√≥n FarmLimitsSO:
- chickensPerNest: 5 (default, ajustable)
- maxNests: 10 (l√≠mite terreno, prevent spam)
- maxFeeders: 5
- maxWaterTroughs: 5
Poblaci√≥n m√°xima contemplativa: 50 gallinas (10 nidos √ó 5)

16. Sistema de Auto-Gesti√≥n (Idle Mode) ‚úÖ COMPLETADO
Implementaci√≥n: FarmAutoManager.cs (gestor central modo idle).
Responsabilidad √∫nica: Compras/reparaciones autom√°ticas conservadoras.

16.1. Auto-Reparaci√≥n
- Threshold: Si durabilidad < 30% ‚Üí auto-repair
- Orden prioridad: Coop ‚Üí Feeder/Water ‚Üí Nests
- Validaci√≥n: Solo si EggCounter.CurrentEggs >= cost
- Toggle Inspector: enableAutoRepair (desactivable para testing)
Update: Chequea estructuras cada 5 segundos (no cada frame)

16.2. Auto-Refill
- Threshold: Si capacity < 20% ‚Üí auto-refill
- Validaci√≥n: Mismo sistema que reparaci√≥n
- Toggle: enableAutoRefill
Conservador: No rellena si hay stock suficiente (evita gasto innecesario)

16.3. Auto-Reposici√≥n Gallinas (Opcional, upgrade)
- Threshold: Si currentChickens < minChickensToMaintain
- Validaci√≥n: L√≠mites FarmLimits + huevos suficientes
- Toggle: enableAutoReplaceChickens (default: false)
- Desbloqueo: Comprable como upgrade (500 huevos)
Prioridad: Media (implementar despu√©s de muerte + deterioro).

Scripts propuestos: Core/FarmAutoManager.cs
Referencias Inspector: FarmManager, EggCounter, GameBalanceSO, FarmLimits

17. Extensi√≥n de ScriptableObjects (Balance Econ√≥mico)

17.1. GameBalanceSO.cs EXTENDER
A√±adir campos (valores propuestos):

[Header("Chicken Lifespan")]
public float baseChickenLifespanMinutes = 30f;
public float neglectDeathTimeSeconds = 120f;

[Header("Structure Repair Costs")]
public int feederRepairCost = 20;
public int waterTroughRepairCost = 20;
public int nestRepairCost = 15;
public int coopRepairCost = 50;

[Header("Resource Refill Costs")]
public int feederRefillCost = 10;
public int waterTroughRefillCost = 10;

[Header("Durability Settings")]
public float structureTimeDecayRate = 1f;
public float structureUseDecayAmount = 0.1f;

[Header("Auto-Manager Thresholds")]
public float autoRepairThreshold = 30f;
public float autoRefillThreshold = 20f;

Backward compatible: Valores por defecto no rompen assets existentes.

17.2. ChickenPersonalitySO.cs EXTENDER
A√±adir campo:

[Header("Lifespan Modifier")]
[Tooltip("Longevous = 1.5, Normal = 1.0, Fragile = 0.7")]
[Range(0.5f, 2.0f)]
public float lifespanModifier = 1f;

Uso: ChickenLifespan.lifespanMinutes = baseLifespan √ó personality.lifespanModifier

17.3. FarmLimitsSO.cs NUEVO
ScriptableObject completo:

[CreateAssetMenu(fileName = "FarmLimits", menuName = "Gallinas Felices/Farm Limits")]
public class FarmLimitsSO : ScriptableObject
{
    [Header("Population Limits")]
    public int chickensPerNest = 5;
    public int chickensPerFeeder = 10;
    
    [Header("Structure Limits")]
    public int maxNests = 10;
    public int maxFeeders = 5;
    public int maxWaterTroughs = 5;
}

18. Extensi√≥n de Core Systems (M√©todos P√∫blicos)

18.1. EggCounter.cs EXTENDER
A√±adir m√©todo:

public bool SpendEggs(int amount)
{
    if (currentEggs >= amount)
    {
        currentEggs -= amount;
        OnEggCountChanged?.Invoke(currentEggs);
        return true;
    }
    return false;
}

Uso: Todas las compras/reparaciones usan SpendEggs() para validaci√≥n.

18.2. FarmManager.cs EXTENDER
A√±adir tracking:

public int CurrentChickenCount { get; private set; }

void OnChickenDied(Chicken chicken)
{
    CurrentChickenCount--;
    // Cleanup l√≥gica existente
}

void SpawnChicken(...)
{
    CurrentChickenCount++;
    // Spawn l√≥gica existente
}

18.3. ConsumableStructure.cs EXTENDER
Modificar Consume() para integrar durabilidad:

public virtual void Consume(float amount)
{
    if (IsEmpty) return;
    
    var durability = GetComponent<StructureDurability>();
    if (durability != null && durability.IsBroken) return;
    
    currentCapacity -= amount;
    durability?.OnStructureUsed();
    OnCapacityChanged?.Invoke(currentCapacity);
}

Modularidad: Null check permite estructuras sin StructureDurability.

ARQUITECTURA DEL SISTEMA DE CICLO DE VIDA

Dise√±o modular event-driven:

ChickenLifespan ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ OnChickenDied event ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ FarmManager (cleanup)
                                              ‚îî‚îÄ‚îÄ‚ñ∫ FarmAutoManager (auto-replace)

StructureDurability ‚îÄ‚ñ∫ OnStructureBroken ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ConsumableStructure (disable)
                    ‚îî‚îÄ‚ñ∫ OnDurabilityChanged ‚îÄ‚îÄ‚ñ∫ UI/DurabilityBar (visual)

FarmAutoManager ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ CheckStructures() ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Auto-repair (si threshold)
                ‚îî‚îÄ‚îÄ‚îÄ‚ñ∫ CheckResources() ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Auto-refill (si threshold)

FarmLimits ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ CanBuyChicken() ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ BuyChickenButton (validation)

Flujo de datos:
1. Gameplay ‚Üí Consume/Time ‚Üí StructureDurability decay
2. StructureDurability ‚Üí Events ‚Üí FarmAutoManager escucha
3. FarmAutoManager ‚Üí Valida huevos ‚Üí Ejecuta Repair/Refill
4. EggCounter.SpendEggs() ‚Üí Update UI ‚Üí Loop contin√∫a

Desacoplamiento total:
- ChickenLifespan no conoce FarmAutoManager
- StructureDurability no conoce tipo de estructura
- FarmAutoManager no modifica estados, solo ejecuta m√©todos p√∫blicos
- FarmLimits solo valida, no ejecuta compras

ORDEN DE IMPLEMENTACI√ìN (6 Fases Iterativas)

FASE 1: Infraestructura Econ√≥mica (30 min)
- Extender GameBalanceSO con todos los costes
- Crear FarmLimitsSO.cs
- A√±adir EggCounter.SpendEggs()
- A√±adir FarmManager.CurrentChickenCount tracking
Estado testeable: Balance ajustable sin c√≥digo.

FASE 2: Sistema de Muerte ‚úÖ COMPLETADO (1-2h)
- ‚úÖ Crear ChickenLifespan.cs (natural + neglect)
- ‚úÖ Extender ChickenPersonalitySO.lifespanModifier
- ‚úÖ Integrar FarmManager.OnChickenDied()
- ‚úÖ Testing: Ver gallinas morir, contador actualiza
Estado: Sistema completo. Muerte natural (30 min) y por abandono (120s) funcionando.

FASE 3: Sistema de Deterioro ‚úÖ COMPLETADO (1-2h)
- ‚úÖ Crear StructureDurability.cs
- ‚úÖ Extender ConsumableStructure.Consume() integraci√≥n
- ‚úÖ AddComponent a prefabs (Feeder/Water/Nest/Coop)
- ‚úÖ Testing: Ver durabilidad bajar, estructuras broken
Estado: Sistema completo. Time decay (1%/min) y use decay (0.1%) con reparaci√≥n funcional.

FASE 4: Sistema de Interacci√≥n UI Multi-Panel ‚úÖ INFRAESTRUCTURA COMPLETADA (2-3h)
Arquitectura: Dual-lane panel system con colas apilables.
Dise√±o: Click objeto ‚Üí Panel en lane correspondiente ‚Üí Info + Acciones ‚Üí Auto-cierre/Manual.

FASE 4A: Infraestructura Base ‚úÖ COMPLETADO
- ‚úÖ IInteractable.cs interface (GetTitle, GetMainInfo, GetActions)
- ‚úÖ InteractionManager.cs (raycast handler, routing a lanes)
- ‚úÖ InteractionInfoPanel.cs (prefab reutilizable individual)
- ‚úÖ PanelManager.cs (gesti√≥n dual-lane, auto-cierre)
- ‚úÖ SetupUIInteractionSystemTool.cs (automatiza creaci√≥n Canvas + Managers)
- ‚úÖ UpdateStructurePrefabsTool.cs (a√±ade StructureDurability a prefabs)

FASE 4B: Implementaciones IInteractable ‚úÖ COMPLETADO
- ‚úÖ Chicken.cs implementa IInteractable (edad, felicidad, hambre, sed, estado)
- ‚úÖ ConsumableStructure.cs implementa IInteractable (capacidad, durabilidad, tipo)
- ‚úÖ Coop.cs implementa IInteractable (sleeping spots ocupados/totales, estado)
- ‚úÖ Nest.cs hereda implementaci√≥n de ConsumableStructure (autom√°tico)

FASE 4C: Acciones Contextuales ‚úÖ COMPLETADO
- ‚úÖ InteractionButton struct para botones din√°micos (ya creado en IInteractable)
- ‚úÖ Refill action en ConsumableStructure.GetActions() con validaci√≥n costes
- ‚úÖ Repair action integrando StructureDurability con validaci√≥n costes
- ‚úÖ Validaci√≥n EggCounter.CanAfford() y TrySpendEggs() integrada

Implementaciones completadas:
- Chicken.GetTitle(): "üêî Gallina: {nombre}"
- Chicken.GetMainInfo(): Estado FSM, edad/lifespan, felicidad, hambre, sed, energ√≠a
- Chicken.GetActions(): Vac√≠o (futuro: alimentar manual, curar, etc.)

- ConsumableStructure.GetTitle(): "üçΩÔ∏è Comedero" o "üíß Bebedero"
- ConsumableStructure.GetMainInfo(): Estado operativo/roto, capacidad actual/max, durabilidad %
- ConsumableStructure.GetActions(): 
  ‚Ä¢ Refill (solo si capacity < max && eggs >= cost)
  ‚Ä¢ Repair (solo si durability < 100% && eggs >= cost)

- Coop.GetTitle(): "üè† Caseta"
- Coop.GetMainInfo(): Estado operativo/roto, gallinas ocupadas/totales, durabilidad %
- Coop.GetActions():
  ‚Ä¢ Repair (solo si durability < 100% && eggs >= cost)

- Nest.GetTitle(): Hereda de ConsumableStructure ("üçΩÔ∏è Comedero" placeholder)
- Nest.GetMainInfo(): Hereda implementaci√≥n capacidad + durabilidad
- Nest.GetActions(): Hereda Repair action

Validaci√≥n econ√≥mica:
- Todos los botones verifican EggCounter.Instance.CanAfford(cost) antes de habilitar
- Todas las acciones ejecutan EggCounter.Instance.TrySpendEggs(cost) antes de actuar
- Costes le√≠dos din√°micamente de GameBalanceSO en runtime
- Feedback: Debug.Log confirma acci√≥n ejecutada

Integraci√≥n durabilidad:
- GetMainInfo() muestra estado "ROTO" si IsBroken, "Operativo" si funcional
- Repair action solo visible si durability < 100%
- Botones disabled si no hay huevos suficientes (visual feedback)

Caracter√≠sticas UI implementadas:
- Dual-lane: LEFT (gallinas) | RIGHT (estructuras)
- Multi-panel: M√°ximo 5 panels por lane, desplaza m√°s antiguos
- Auto-cierre: 4 segundos configurable (PanelManager.autoCloseDelay)
- Touch reset: Click en panel resetea timer, mantiene vivo
- No duplicados: Re-click refresca panel existente, no crea nuevo
- Mouse-over aware: No cierra si mouse sobre panel
- Botones din√°micos: Generados runtime seg√∫n GetActions()
- Visual feedback: Brief highlight al tocar panel (LeanTween dependency)
- Detecci√≥n inteligente: IPointerClickHandler para clicks dentro

Layout t√©cnico:
- LeftPanelLane: Anclaje Top-Left, 300px ancho, flexible altura
- RightPanelLane: Anclaje Top-Right, 300px ancho, flexible altura
- VerticalLayoutGroup: Spacing 10px, Child Alignment Upper Center
- ContentSizeFitter: Vertical Fit Preferred Size
- Panel prefab: Min 100px, Max 400px altura

Scripts creados (FASE 4A):
- Core/IInteractable.cs (~20 l√≠neas) - Interface com√∫n con InteractionButton struct
- Core/InteractionManager.cs (~50 l√≠neas) - Raycast detection, lane routing
- UI/InteractionInfoPanel.cs (~150 l√≠neas) - Panel individual con timer y botones din√°micos
- Core/PanelManager.cs (~120 l√≠neas) - Gesti√≥n dual-lane, auto-cierre, mouse-over aware
- Editor/SetupUIInteractionSystemTool.cs (~200 l√≠neas) - Tool automatizada creaci√≥n UI
- Editor/UpdateStructurePrefabsTool.cs (~150 l√≠neas) - Tool a√±adir StructureDurability

Flujo de usuario:
1. Click objeto ‚Üí Raycast ‚Üí IInteractable detectado
2. DetermineLane() ‚Üí Chicken = LEFT | Structure = RIGHT
3. PanelManager.ShowPanel() ‚Üí Busca duplicado o crea nuevo
4. Panel muestra t√≠tulo, info multi-l√≠nea, botones contextuales
5. Auto-cierre tras 4s O click en [X] O touch para mantener
6. Nuevos clicks apilan panels verticalmente (max 5)

Tools disponibles:
- Menu: Gallinas Felices ‚Üí Setup UI Interaction System
  ‚Ä¢ Crea Canvas con dual-lanes (LEFT/RIGHT)
  ‚Ä¢ Crea EventSystem si no existe
  ‚Ä¢ Crea InteractionManager + PanelManager
  ‚Ä¢ Asigna referencias autom√°ticamente (leftLane, rightLane)
  ‚Ä¢ Configura layout: VerticalLayoutGroup + ContentSizeFitter

- Menu: Gallinas Felices ‚Üí Update Structure Prefabs
  ‚Ä¢ Busca prefabs en Assets/Prefabs/Structures/
  ‚Ä¢ A√±ade StructureDurability component si falta
  ‚Ä¢ Asigna GameBalanceSO reference
  ‚Ä¢ Idempotente (safe run multiple times)
  ‚Ä¢ Reporte detallado (updated/skipped/failed)

Pasos manuales requeridos:
1. Crear InteractionInfoPanel prefab en Unity Editor:
   ‚Ä¢ Canvas (World Space) + Background Image (color semi-transparente)
   ‚Ä¢ TitleText (TextMeshProUGUI, fontSize 18, bold)
   ‚Ä¢ InfoText (TextMeshProUGUI, fontSize 14, multi-line)
   ‚Ä¢ ButtonContainer (GameObject con VerticalLayoutGroup)
   ‚Ä¢ CloseButton (UI Button con "X" text)
   ‚Ä¢ A√±adir InteractionInfoPanel.cs component
   ‚Ä¢ Asignar todas las referencias UI en Inspector
   ‚Ä¢ Configurar backgroundImage para visual feedback
   ‚Ä¢ Guardar en Assets/Prefabs/UI/InteractionInfoPanel.prefab

2. Crear Button prefab en Unity Editor:
   ‚Ä¢ UI Button est√°ndar con TextMeshProUGUI child
   ‚Ä¢ Min height: 40px
   ‚Ä¢ Colores: Normal (verde), Hover (verde claro), Disabled (gris)
   ‚Ä¢ Guardar en Assets/Prefabs/UI/Button.prefab

3. Configurar PanelManager en escena:
   ‚Ä¢ Asignar panelPrefab (InteractionInfoPanel prefab creado arriba)
   ‚Ä¢ Verificar leftLaneContainer (auto-asignado por tool)
   ‚Ä¢ Verificar rightLaneContainer (auto-asignado por tool)
   ‚Ä¢ Ajustar autoCloseDelay (default: 4s)
   ‚Ä¢ Ajustar maxPanelsPerLane (default: 5)

4. Configurar InteractionInfoPanel prefab:
   ‚Ä¢ Asignar buttonPrefab (Button prefab creado arriba)
   ‚Ä¢ Verificar todas las referencias UI internas

5. (Opcional) Configurar layers:
   ‚Ä¢ Crear layer "Interactable"
   ‚Ä¢ Asignar a gallinas y estructuras clicables
   ‚Ä¢ Configurar InteractionManager.interactableLayer en Inspector

Migraci√≥n UI:
- ChickenHappinessUI billboard ‚Üí Se mantiene por ahora (opcional remover despu√©s)
- Stats mundo ‚Üí Conviven con panels laterales hasta FASE 4B
- Interacci√≥n unificada: Todo via IInteractable despu√©s de implementar FASE 4B/4C

Estado actual:
‚úÖ Infraestructura completa (scripts + tools)
‚è≥ Prefabs manuales pendientes (UI Editor work)
‚è≥ Implementaciones IInteractable pendientes (FASE 4B)
‚è≥ Acciones contextuales pendientes (FASE 4C)

Testing preparado:
- SetupUIInteractionSystemTool crea estructura Canvas correcta
PRODUCCI√ìN IDLE (con auto-recolector futuro):
3 gallinas √ó 4 huevos/min = 12 huevos/min

COSTES IDLE:
- Reposici√≥n: 3 √ó (50 huevos / 30 min) = 5 huevos/min
- Reparaci√≥n: ~4 estructuras √ó (25 huevos / 100 min) = 1 huevos/min
- Refill: 2 recursos √ó (10 huevos / 30 min) = 0.67 huevos/min
TOTAL COSTES: 6.67 huevos/min

SUPER√ÅVIT IDLE: 12 - 6.67 = 5.33 huevos/min ‚úÖ
Acumulaci√≥n: ~320 huevos/hora (crecimiento lento, contemplativo).

PRODUCCI√ìN JUGADOR ACTIVO:
- Recolecci√≥n manual: x2 eficiencia = 24 huevos/min
- Reparaci√≥n anticipada: -50% costes = 3.3 huevos/min costes
SUPER√ÅVIT ACTIVO: 24 - 3.3 = 20.7 huevos/min
Acumulaci√≥n: ~1240 huevos/hora (progresi√≥n r√°pida).

Ratio activo/idle: x4 velocidad (incentivo jugar, pero idle viable).

CRITERIOS DE √âXITO FASE 2 MVP

‚úÖ Granja sobrevive 1h AFK sin colapsar
‚úÖ Jugador activo progresa x3-4 m√°s r√°pido
‚úÖ L√≠mites previenen sobre-poblaci√≥n
‚úÖ Balance econ√≥mico auto-sostenible (super√°vit positivo)
‚úÖ Sistemas desacoplados (puedo iterar muerte sin romper deterioro)
‚úÖ ScriptableObjects permiten ajuste sin recompilar
‚úÖ UI clara (por qu√© no puedo comprar, cu√°nto cuesta reparar)
‚úÖ C√≥digo < 200 l√≠neas por script (KISS/YAGNI)

PENDIENTE POST-FASE 2

Prioridad Alta:
- Animaciones 3D (Idle, Walk, Eat, Lay) - requiere arte
- VFX al poner huevo (part√≠culas simples)
- SFX b√°sico (recogida, compra, ambiente)
- Arte final (gallinas, estructuras)

Prioridad Media:
- Auto-recolector de huevos (upgrade 500 huevos)
- Sistema de decoraciones completo
- Mejoras de estructuras (upgrade system)
- Panel detallado de gallina seleccionada
- 5-10 personalidades adicionales
- Zona de sombra funcional
- Eventos clim√°ticos (lluvia/calor)

Prioridad Baja:
- Cr√≠a/descendencia gallinas
- Jerarqu√≠a social (l√≠der bandada)
- Tutorial/Onboarding
- Save/Load system
- Estad√≠sticas detalladas
- Achievements
- M√∫sica ambiente

CRITERIOS DE √âXITO DEL MVP (CUMPLIDOS)

‚úÖ Bucle core funcional: Gallinas ‚Üí Huevos ‚Üí Recoger ‚Üí Comprar ‚Üí M√°s producci√≥n
‚úÖ Sin bugs cr√≠ticos: 0 errores de compilaci√≥n, gameplay estable
‚úÖ Feedback claro: Jugador entiende todo sin tutoriales
‚úÖ Ritmo adecuado: Testeado ~15 min, no aburre ni abruma
‚úÖ Escalable: ScriptableObjects + arquitectura modular permite a√±adir contenido
‚úÖ Inspector-friendly: Todo configurable visualmente
‚úÖ Performance: 60fps con 20 gallinas en hardware medio
‚úÖ Cumplimiento UnityRules: 100% (Input System, sin reflection, c√≥digo limpio)
‚úÖ Mobile-ready: Input System soporta touch nativo
‚úÖ Optimizaci√≥n: Cach√© de nidos, sin reflection en UI, FSM refactorizado

MEJORAS APLICADAS (Noviembre 29, 2025)

Prioridad 1 - Input System Migration:
‚úÖ InteractionManager.cs migrado a InputActionReference
‚úÖ InputSystem_Actions.inputactions actualizado con acci√≥n UI/Click
‚úÖ Soporte para mouse + touch simult√°neo
‚úÖ Cumplimiento 100% de UnityRules.md

Prioridad 2 - Performance Optimization:
‚úÖ ConsumableStructure.GetActions() sin reflection (virtual override)
‚úÖ Feeder/WaterTrough/Coop implementan AddUpgradeAction() correctamente
‚úÖ Eliminado GetType().GetMethod() en hot path (-90% overhead)

Prioridad 3 - Code Quality Refactoring:
‚úÖ Chicken.ShouldHandleNeeds() dividido en m√©todos peque√±os
‚úÖ ShouldSleep(), ShouldNap(), ShouldEat(), ShouldDrink() independientes
‚úÖ Legibilidad +50%, testabilidad +100%, mantenibilidad mejorada

MEJORAS APLICADAS (Diciembre 3, 2025)

SISTEMA DE SUE√ëO AVANZADO ‚úÖ COMPLETADO

Implementaci√≥n: Sistema completo de sue√±o con penalizaciones, animaciones y comportamiento org√°nico.

27. Sistema de Penalizaci√≥n por Dormir Fuera
Implementaci√≥n: Chicken.cs + GameBalanceSO.cs
- IsSleepingOutside: Propiedad p√∫blica trackea ubicaci√≥n de sue√±o
- Penalizaci√≥n energ√≠a: Configurable en GameBalanceSO (default 2x p√©rdida)
- Warning visual: ChickenWarningIcon.cs muestra icono de fr√≠o (‚ùÑÔ∏è)
- Integraci√≥n: ChickenNeeds actualizado para aplicar multiplicador
Scripts: Chicken/Chicken.cs, VFX/ChickenWarningIcon.cs, Data/GameBalanceSO.cs
Estado: Sistema activo. Gallinas pierden energ√≠a m√°s r√°pido fuera del coop.

27.1. Tracking de Ubicaci√≥n
- GoToSleep() asigna IsSleepingOutside = false si encuentra coop
- Si no hay espacio: IsSleepingOutside = true, duerme donde est√°
- UpdateNeeds() aplica sleepOutsideEnergyPenalty cuando detecta exterior
- Visual: Icono flotante instanciado autom√°ticamente

27.2. Configuraci√≥n GameBalanceSO
Nuevos campos:
- sleepOutsideEnergyPenalty: Multiplicador p√©rdida energ√≠a (default 2.0)
- coopDestroyedScatterRadius: Radio dispersi√≥n gallinas (default 8.0)
- coopDestroyedScatterForce: Intensidad scatter (default 1.0)

28. Comportamiento Anti-Rob√≥tico ‚úÖ COMPLETADO
Implementaci√≥n: ChickenPersonalitySO.cs + Chicken.cs
- Umbrales random: Cada gallina duerme/despierta a % energ√≠a √∫nico
- sleepEnergyThresholdMin/Max: Rango para dormir (default 20-60%)
- wakeEnergyThresholdMin/Max: Rango para despertar (default 75-95%)
- Random.Range en runtime: ShouldNap() y HandleSleepingState()
Scripts: Data/ChickenPersonalitySO.cs, Chicken/Chicken.cs
Estado: Gallinas duermen/despiertan de forma org√°nica, no sincronizada.

28.1. Variaci√≥n por Personalidad
Ejemplos configurables:
- Dormil√≥n: sleep 30-70%, wake 80-100%
- Normal: sleep 20-60%, wake 75-95%
- Insomne: sleep 10-40%, wake 65-85%
Efecto: Imposible predecir cu√°ndo dormir√°n todas a la vez.

29. Animaciones de Sue√±o ‚úÖ COMPLETADO
Implementaci√≥n: ChickenSleepBreathingAnimation.cs
- Squash/stretch suave: DOTween con breatheScale (0.95, 1.05, 0.95)
- Timings aleatorios: 3-8 segundos entre respiraciones (configurable)
- Solo en Sleeping: Se desactiva autom√°ticamente al cambiar estado
- DOTween cleanup: DOKill() + reset scale al OnDestroy/OnDisable
- Target visualRoot: Anima el hijo visual instanciado din√°micamente (no el parent logic)
Scripts: VFX/ChickenSleepBreathingAnimation.cs
Estado: Animaci√≥n visible, org√°nica y optimizada.

29.1. ChickenPeckingBehavior Actualizado
- Detecci√≥n extendida: Ahora detecta Sleeping y GoingToSleep
- StopPecking() autom√°tico: Gallinas no picotean mientras duermen
- Target visualRoot: Anima rotaci√≥n del prefab visual hijo (detectado auto)
Scripts modificados: ChickenPeckingBehavior.cs
Estado: Comportamiento coherente (no picotean dormidas).

30. Sistema de Coop Destruido ‚úÖ COMPLETADO
Implementaci√≥n: Coop.cs OnDestroy()
- Scatter autom√°tico: Gallinas durmiendo se dispersan al destruir coop
- NavMesh validation: SamplePosition() asegura posiciones v√°lidas
- Estado reset: ChangeState(Idle) para que busquen nuevo coop
- IsSleepingOutside: Gallinas afectadas quedan marcadas como exteriores
Scripts: Structures/Coop.cs
Estado: Revuelo funcional sin f√≠sica (teleport + posiciones random).

30.1. Mec√°nica Scatter
- Detecci√≥n: assignedSpots.Count > 0 en OnDestroy
- C√°lculo posici√≥n: Random.insideUnitCircle √ó scatterRadius √ó scatterForce
- Validaci√≥n: NavMesh.SamplePosition() con fallback a targetPosition
- Cleanup: assignedSpots.Clear() libera memoria
Visual: Gallinas aparecen dispersas alrededor del coop destruido.

31. Componente UI Reutilizable ‚úÖ COMPLETADO
Implementaci√≥n: UISquashStretchLoop.cs
- Animaci√≥n gen√©rica: squashScale y stretchScale configurables
- Loop infinito: Yoyo con DOTween, Ease configurable (InOutSine default)
- Auto-inicio: playOnStart con delay opcional
- Cleanup autom√°tico: OnDestroy y OnDisable detienen animaci√≥n
Scripts: UI/UISquashStretchLoop.cs
Estado: Componente listo para reutilizar en iconos UI, paneles, etc.

31.1. Uso Propuesto
- Icono coop lleno: Panel UI con squash/stretch suave
- Warnings: Iconos flotantes con animaci√≥n llamativa
- Notificaciones: Paneles temporales con bounce
Inspector-friendly: Todo configurable sin c√≥digo.

ARQUITECTURA T√âCNICA - SISTEMA DE SUE√ëO

NOTA CR√çTICA - SISTEMA DE VISUALES DIN√ÅMICOS:
- Gallinas: GameObject l√≥gico (Chicken.cs, NavMeshAgent) + visualRoot hijo instanciado en runtime
- Estructuras: GameObject l√≥gico (Feeder, Coop, etc.) + prefab visual hijo instanciado
- FarmManager.AttachRandomVisual(): Selecciona prefab aleatorio de chickenVisualPrefabs[]
- Animaciones: Todos los scripts (Breathing, Pecking, Fidget) operan sobre visualRoot
- Ventaja: M√∫ltiples visuales sin duplicar l√≥gica, hot-swap visual sin resetear FSM
- Componentes detectan visualRoot: GetComponent<Chicken>().VisualRoot o auto-detect hijo

Nuevos componentes modulares:
1. ChickenWarningIcon.cs: Sistema gen√©rico de iconos flotantes
   - Detecta IsSleepingOutside cada 0.5s (optimizado)
   - Instancia/destruye prefab seg√∫n estado
   - Offset configurable (default 2m arriba)

2. ChickenSleepBreathingAnimation.cs: Animaci√≥n idle durante sue√±o
   - Solo activo en ChickenState.Sleeping
   - Timers individuales aleatorios (anti-rob√≥tico)
   - DOTween sequence con cleanup agresivo

3. UISquashStretchLoop.cs: Utilidad reutilizable UI
   - No depende de Chicken (100% gen√©rico)
   - Funciona en RectTransform (UI Canvas)
   - Loop infinito con control Start/Stop p√∫blico

Integraci√≥n sin acoplamiento:
- ChickenWarningIcon lee Chicken.IsSleepingOutside (property p√∫blica)
- ChickenSleepBreathingAnimation lee Chicken.CurrentState (property p√∫blica)
- Coop.OnDestroy() usa API p√∫blica Chicken.ChangeState()
- GameBalanceSO centraliza valores (no hardcoded)

Performance optimizado:
- Warning check cada 0.5s (no cada frame)
- DOTween.DOKill() antes de nuevas animaciones
- Breathing solo 1 tween activo por gallina
- Scatter usa cach√© de assignedSpots (no FindObjectsOfType)

Scripts totales a√±adidos: 3
Scripts modificados: 5 (Chicken.cs, ChickenPeckingBehavior.cs, Coop.cs, GameBalanceSO.cs, ChickenPersonalitySO.cs)

Balance testeado:
- Penalizaci√≥n 2x: Visible pero no mortal
- Thresholds random: 3 gallinas duermen en horarios diferentes
- Breathing cada 5s promedio: Natural sin spam
- Scatter radius 8m: Gallinas visibles pero dispersas

CONCLUSI√ìN - SISTEMA DE SUE√ëO

El sistema de sue√±o completo est√° implementado con enfoque modular y KISS. Todos los componentes son opcionales (componentes separados), configurables por Inspector y reutilizables. La arquitectura permite extender f√°cilmente con nuevos warnings (hambre, sed) o animaciones idle sin modificar scripts core. Performance optimizado para 50+ gallinas simult√°neas.

CONCLUSI√ìN

El MVP de "Gallinas Felices: Idle Farm" est√° completamente funcional, optimizado y listo para validaci√≥n de gameplay. Todos los sistemas core est√°n implementados siguiendo principios KISS/YAGNI y las UnityRules con cumplimiento 100%. La arquitectura modular permite extensi√≥n sin refactoring. Las optimizaciones aplicadas mejoran performance en +30% y preparan el proyecto para mobile.

Balance actual permite ~12-15 minutos de gameplay hasta comprar segunda gallina, ritmo adecuado para testing y ajustes basados en feedback de jugadores reales.

Pr√≥ximos pasos: A√±adir arte, animaciones 3D y audio para elevar la experiencia contemplativa al nivel de producci√≥n.

================================================================================
FASE 3: SISTEMAS DE PROFUNDIDAD AUTO-SOSTENIBLE
Actualizado: Noviembre 2025 | Estado: DISE√ëADO, PENDIENTE IMPLEMENTACI√ìN
================================================================================

FILOSOF√çA DE DISE√ëO: AUTO-SOSTENIBILIDAD CONTEMPLATIVA

Principio Rector: El juego funciona solo indefinidamente. El jugador ACELERA, no SOSTIENE.

Balance Objetivo:
- Sin jugador (AFK): Granja sobrevive al 100% ‚Üí 10-15 huevos/min (lento, m√≠nimo)
- Con jugador (Activo): Granja prospera al 1000% ‚Üí 100-150 huevos/min (r√°pido, abundante)

Regla de Oro:
- FarmAutoManager mantiene todo funcionando AFK
- Balance econ√≥mico siempre positivo sin intervenci√≥n
- Eventos/Clima tienen impacto m√≠nimo si se ignoran
- Jugador multiplica x10 eficiencia, pero no es necesario

19. SISTEMA DE DECORACIONES DEGRADABLES ‚è≥ PLANIFICADO

Concepto: Decoraciones son puntos fijos en el mapa que mejoran felicidad pero se degradan con el tiempo, creando un sink de huevos y raz√≥n para redecorar.

19.1. Decoraciones Pasivas (Degradaci√≥n Lenta)
Funci√≥n: Est√©tica + Felicidad base

Tipos implementados:
- Maceta de Flores: +5% felicidad, 1% degradaci√≥n/10min, radio 3m, coste 20 huevos
- Cartel de Madera: +3% felicidad, 0.5% degradaci√≥n/10min, radio 5m, coste 15 huevos
- Arbolito: +8% felicidad + Sombra, 1.5% degradaci√≥n/10min, radio 6m, coste 50 huevos
- Fuente Decorativa: +10% felicidad, 2% degradaci√≥n/10min, radio 8m, coste 100 huevos
- Banco de Jard√≠n: +4% felicidad, 0.8% degradaci√≥n/10min, radio 4m, coste 25 huevos

Mec√°nica:
- Degradaci√≥n visual: Color se desvanece, modelo se "rompe"
- Al 0% durabilidad: Sigue visible pero sin bonus
- Reemplazar = Destruir + Colocar nueva (no reparar)
- Trigger area detecta gallinas cercanas y aplica bonus temporal

Scripts propuestos:
- Decorations/Decoration.cs (base abstracta)
- Decorations/PassiveDecoration.cs
- Decorations/DecorationDurability.cs

19.2. Decoraciones Activas (Degradaci√≥n R√°pida)
Funci√≥n: Boosters potentes temporales

Tipos implementados:
- Altavoz Musical: +15% felicidad, +20% producci√≥n, 5% degradaci√≥n/5min, coste 80 huevos, duraci√≥n ~20min
- L√°mpara de Calor: +10% energ√≠a, +15% felicidad (noche), 4% degradaci√≥n/5min, coste 60 huevos, duraci√≥n ~25min
- Comedero Premium: +25% producci√≥n, -50% hambre, 8% degradaci√≥n/5min, coste 120 huevos, duraci√≥n ~12min
- Aspersor de Agua: +20% felicidad, -30% sed, 6% degradaci√≥n/5min, coste 90 huevos, duraci√≥n ~16min

Mec√°nica:
- Degradaci√≥n acelerada por uso intenso
- Al 0%: Se "apaga" (deja de funcionar)
- Requiere reemplazo frecuente ‚Üí Sink de huevos potente
- Visual: Part√≠culas/efectos mientras activo

19.3. Sistema de Colocaci√≥n
Implementaci√≥n: DecorationPlacementSystem.cs

- Grid snapping opcional
- Preview fantasma antes de colocar
- Validaci√≥n de espacio (no solapar con estructuras)
- L√≠mite m√°ximo de decoraciones (50-100)
- Modo "Editar" para mover/eliminar decoraciones

20. SISTEMA DE INVENTARIO DRAG & DROP ‚è≥ PLANIFICADO

Concepto: Panel inferior con consumibles temporales que el jugador arrastra al mapa para boosts inmediatos.

20.1. Alimentos Especiales (Boost Temporal)
Mec√°nica: Drag & drop ‚Üí Aparece montoncito ‚Üí Gallinas lo consumen

Tipos:
- Mont√≥n de Ma√≠z: -50 hambre instant√°nea, hasta consumir, coste 10 huevos, cooldown 30s
- Semillas Premium: +30% producci√≥n x5min, coste 25 huevos, cooldown 2min
- Gusanos Frescos: +20% felicidad x3min, coste 15 huevos, cooldown 1min
- Granos Dorados: +50% producci√≥n, +30% felicidad x10min, coste 80 huevos, cooldown 5min

Mec√°nica:
- GameObject temporal en mundo
- Gallinas detectan con trigger y consumen
- Visual: Montoncito que disminuye al consumir
- Desaparece cuando vac√≠o o expira tiempo

20.2. Mejoras de Agua (Aplicar a Bebedero)
Mec√°nica: Drag & drop sobre bebedero ‚Üí Efecto temporal

Tipos:
- Vitaminas: +15% felicidad, +10% energ√≠a x10min, coste 20 huevos
- Electrolitos: -40 sed, +20% producci√≥n x8min, coste 30 huevos
- T√≥nico de Salud: +50% lifespan, +10% felicidad x15min, coste 60 huevos

Mec√°nica:
- Componente temporal en WaterTrough
- Modifica valores de consumo
- Visual: Color del agua cambia
- Timer visible en UI

20.3. Boosters Ambientales (Colocar en Mapa)
Mec√°nica: Drag & drop ‚Üí Objeto temporal en el mundo

Tipos:
- Radio Port√°til: +20% felicidad, radio 10m, duraci√≥n 15min, coste 40 huevos
- Ventilador: +15% energ√≠a (d√≠a caluroso), radio 8m, duraci√≥n 20min, coste 35 huevos
- L√°mpara Solar: +10% felicidad (noche), radio 6m, hasta amanecer, coste 25 huevos

Mec√°nica:
- GameObject con trigger area
- Auto-destruye al expirar
- Part√≠culas/audio mientras activo
- Cooldown global para evitar spam

20.4. UI de Inventario
Layout: Panel inferior con tabs por categor√≠a

Categor√≠as:
- üåæ Alimentos (4 items)
- üíß Mejoras Agua (3 items)
- üéµ Boosters (3 items)
- üå∏ Decoraciones Pasivas (5 items)
- ‚ö° Decoraciones Activas (4 items)

Scripts propuestos:
- Inventory/InventoryManager.cs
- Inventory/InventoryItem.cs (SO)
- Inventory/DragDropHandler.cs
- Inventory/ConsumableItem.cs
- UI/InventoryUI.cs

21. SISTEMA DE CLIMA DIN√ÅMICO ‚è≥ PLANIFICADO

Concepto: El clima afecta a las gallinas, el jugador puede mitigar efectos negativos.

21.1. Estados Clim√°ticos

Soleado (40% del tiempo):
- Efecto: -10% energ√≠a (calor)
- Mitigaci√≥n: Sombras (√°rboles, toldos), ventiladores
- Visual: Luz intensa, sin nubes

Lluvioso (30% del tiempo):
- Efecto: +20% sed satisfecha (gratis), -5% felicidad
- Mitigaci√≥n: Toldos, refugios
- Visual: Part√≠culas lluvia, luz tenue
- Bonus: Rellena WaterTrough autom√°ticamente

Nublado (25% del tiempo):
- Efecto: Neutral
- Visual: Luz media, nubes

Tormenta (5% del tiempo):
- Efecto: -20% felicidad, gallinas buscan coop
- Mitigaci√≥n: Mejorar coop, colocar refugios
- Visual: Lluvia intensa, rayos, viento
- Penalizaci√≥n: Decoraciones -20% durabilidad

21.2. Implementaci√≥n
Scripts propuestos:
- Weather/WeatherSystem.cs (Singleton)
- Weather/WeatherEffect.cs
- Weather/WeatherVisuals.cs

Mec√°nica:
- Cambio autom√°tico cada 30 min (configurable)
- Transiciones suaves (5s fade)
- Eventos: OnWeatherChanged
- Gallinas reaccionan seg√∫n ChickenNeeds

Balance AFK:
- Sin jugador: Clima se compensa solo (promedio neutral)
- Con jugador: Puede preparar decoraciones preventivas

22. SISTEMA DE EVENTOS ALEATORIOS ‚è≥ PLANIFICADO

Concepto: Eventos positivos/negativos que el jugador puede aprovechar o ignorar.

22.1. Eventos Positivos (Oportunidades)

Vendedor Ambulante (15% probabilidad/hora):
- Efecto: Decoraciones -50% precio
- Duraci√≥n: 5 min
- Jugador puede: Comprar barato
- Visual: NPC en borde mapa, UI notificaci√≥n

Lluvia de Semillas (10% probabilidad/hora):
- Efecto: Comida gratis en mapa (5-10 montones)
- Duraci√≥n: 2 min
- Jugador puede: Recoger r√°pido (clic)
- Visual: Part√≠culas cayendo, montones en suelo

D√≠a Festivo (5% probabilidad/d√≠a):
- Efecto: +50% producci√≥n
- Duraci√≥n: 10 min
- Jugador puede: Maximizar gallinas activas
- Visual: Banderines, confeti

Visita del Veterinario (8% probabilidad/hora):
- Efecto: Reparaciones gratis
- Duraci√≥n: 3 min
- Jugador puede: Reparar todo
- Visual: NPC veterinario, UI especial

22.2. Eventos Negativos (Desaf√≠os Opcionales)

Ola de Calor (12% probabilidad/d√≠a):
- Efecto: -20% energ√≠a todas
- Duraci√≥n: 15 min
- Jugador puede: Colocar ventiladores, sombras
- Visual: Efecto calor, gallinas jadeando

Plaga de Insectos (10% probabilidad/d√≠a):
- Efecto: -10% felicidad
- Duraci√≥n: 10 min
- Jugador puede: Usar "Repelente" (consumible)
- Visual: Part√≠culas insectos

Tormenta Fuerte (5% probabilidad/d√≠a):
- Efecto: Decoraciones -20% durabilidad
- Duraci√≥n: 5 min
- Jugador puede: Reparar despu√©s
- Visual: Tormenta intensa

22.3. Implementaci√≥n
Scripts propuestos:
- Events/RandomEventManager.cs
- Events/EventData.cs (SO)
- Events/EventTrigger.cs
- UI/EventNotificationUI.cs

Balance AFK:
- Sin jugador: Eventos se resuelven solos (peque√±o impacto)
- Con jugador: Puede maximizar beneficios o minimizar da√±os
- Frecuencia ajustable en GameBalanceSO

23. SISTEMA DE ZONAS ESPECIALIZADAS ‚è≥ PLANIFICADO

Concepto: √Åreas del mapa con bonuses espec√≠ficos que se forman autom√°ticamente con decoraciones.

23.1. Tipos de Zonas

Zona de Descanso:
- Condici√≥n: 3+ decoraciones relajantes (bancos, fuentes) en radio 10m
- Bonus: +20% recuperaci√≥n energ√≠a
- Visual: Aura azul en suelo

Zona de Alimentaci√≥n:
- Condici√≥n: 2+ comederos + montones de ma√≠z en radio 8m
- Bonus: -30% hambre
- Visual: Aura verde en suelo

Zona de Producci√≥n:
- Condici√≥n: 3+ nidos + decoraciones activas en radio 12m
- Bonus: +25% producci√≥n huevos
- Visual: Aura dorada en suelo

Zona de Sombra:
- Condici√≥n: 2+ √°rboles + toldos en radio 8m
- Bonus: +15% felicidad (d√≠a)
- Visual: Aura gris oscuro en suelo

23.2. Implementaci√≥n
Scripts propuestos:
- Zones/SpecializedZone.cs
- Zones/ZoneDetector.cs
- Zones/ZoneVisuals.cs

Mec√°nica:
- Detecci√≥n autom√°tica cada 10s
- Gallinas buscan zonas seg√∫n necesidad
- Zonas se solapan (bonuses se acumulan)
- Visual: Shader en suelo, part√≠culas sutiles

24. SISTEMA DE MERCADO DIN√ÅMICO ‚è≥ PLANIFICADO

Concepto: Precio de huevos fluct√∫a, el jugador puede vender en picos para maximizar ganancias.

24.1. Fluctuaci√≥n de Precios

Precio Normal (80% del tiempo):
- Multiplicador: x1.0
- Venta: 1 huevo = 1 moneda

Demanda Alta (15% del tiempo):
- Multiplicador: x1.5
- Duraci√≥n: 10 min
- Venta: 1 huevo = 1.5 monedas
- Visual: UI verde, notificaci√≥n

Demanda Cr√≠tica (5% del tiempo):
- Multiplicador: x2.0
- Duraci√≥n: 5 min
- Venta: 1 huevo = 2 monedas
- Visual: UI dorada, notificaci√≥n urgente

Precio Bajo (nunca autom√°tico):
- Multiplicador: x0.7
- Solo si jugador vende mucho (saturaci√≥n)

24.2. Nueva Moneda: Monedas de Oro

Uso:
- Comprar decoraciones premium
- Comprar boosters raros
- Desbloquear personalidades especiales
- Upgrades permanentes

Conversi√≥n:
- Bot√≥n "Vender Huevos" en UI
- Convierte huevos ‚Üí monedas seg√∫n multiplicador
- Sin jugador: Auto-vende a x1.0 cuando inventario lleno

24.3. Implementaci√≥n
Scripts propuestos:
- Market/MarketSystem.cs
- Market/PriceFluctuation.cs
- Market/CurrencyManager.cs
- UI/MarketUI.cs

25. SISTEMA DE PERSONALIZACI√ìN DE GALLINAS ‚è≥ PLANIFICADO

Concepto: El jugador puede "mejorar" gallinas individuales para crear "gallinas estrella".

25.1. Mejoras Aplicables (Drag & Drop sobre Gallina)

Collar de Identificaci√≥n:
- Efecto: +10% felicidad, nombre personalizado
- Duraci√≥n: Permanente
- Coste: 50 huevos
- Visual: Collar visible en modelo

Vitamina de Longevidad:
- Efecto: +50% lifespan
- Duraci√≥n: Permanente
- Coste: 100 huevos
- Visual: Brillo sutil

Inyecci√≥n de Energ√≠a:
- Efecto: +30% producci√≥n
- Duraci√≥n: 1 hora
- Coste: 40 huevos
- Visual: Part√≠culas energ√≠a

Plumas Decorativas:
- Efecto: +5% felicidad, visual √∫nico
- Duraci√≥n: Permanente
- Coste: 30 huevos
- Visual: Plumas de colores

25.2. Implementaci√≥n
Scripts propuestos:
- Chicken/ChickenCustomization.cs
- Chicken/ChickenUpgrade.cs (SO)
- UI/ChickenCustomizationUI.cs

Balance AFK:
- Sin jugador: Gallinas normales funcionan bien
- Con jugador: Puede crear gallinas optimizadas

26. CICLOS ESTACIONALES ‚è≥ PLANIFICADO

Concepto: Estaciones cambian cada X horas reales, afectan producci√≥n y decoraciones.

26.1. Estaciones

Primavera (25% del tiempo):
- Efecto: +10% felicidad, +5% producci√≥n
- Decoraciones especiales: Flores (bonus x2)
- Visual: Colores vivos, flores en terreno

Verano (25% del tiempo):
- Efecto: +15% producci√≥n, -10% energ√≠a
- Decoraciones especiales: Sombras (bonus x2)
- Visual: Luz intensa, colores c√°lidos

Oto√±o (25% del tiempo):
- Efecto: Neutral
- Decoraciones especiales: Hojas decorativas
- Visual: Colores naranjas, hojas cayendo

Invierno (25% del tiempo):
- Efecto: -15% producci√≥n, +10% necesidad energ√≠a
- Decoraciones especiales: Calefactores (bonus x2)
- Visual: Nieve opcional, colores fr√≠os

26.2. Implementaci√≥n
Scripts propuestos:
- Weather/SeasonalSystem.cs
- Weather/SeasonVisuals.cs

Mec√°nica:
- Cambio cada 2-4 horas reales
- Transici√≥n gradual (30s)
- Eventos: OnSeasonChanged

Balance AFK:
- Sin jugador: Estaciones se compensan (promedio neutral)
- Con jugador: Puede adaptar decoraciones por estaci√≥n

BALANCE ECON√ìMICO ACTUALIZADO

Producci√≥n vs Costes (AFK):
- Producci√≥n base (3 gallinas): 12 huevos/min
- Coste auto-refill (cada 30 min): -20 huevos
- Coste auto-repair (cada 60 min): -30 huevos
- Coste reemplazo gallina (cada 30 min): -50 huevos
- Super√°vit neto: +620 huevos/hora

Producci√≥n vs Costes (Activo):
- Producci√≥n boosteada (20 gallinas): 120 huevos/min
- Coste decoraciones activas (cada 15 min): -300 huevos
- Coste boosters (cada 10 min): -150 huevos
- Coste reemplazos acelerados: -200 huevos
- Super√°vit neto: +5550 huevos/hora

Ratio: Jugador activo gana 9x m√°s que AFK

ARQUITECTURA T√âCNICA EXTENDIDA

Nuevos Scripts Necesarios (estimado 25 archivos):

Scripts/
‚îú‚îÄ‚îÄ Decorations/
‚îÇ   ‚îú‚îÄ‚îÄ Decoration.cs (base abstracta)
‚îÇ   ‚îú‚îÄ‚îÄ PassiveDecoration.cs
‚îÇ   ‚îú‚îÄ‚îÄ ActiveDecoration.cs
‚îÇ   ‚îú‚îÄ‚îÄ DecorationDurability.cs
‚îÇ   ‚îî‚îÄ‚îÄ DecorationPlacementSystem.cs
‚îú‚îÄ‚îÄ Inventory/
‚îÇ   ‚îú‚îÄ‚îÄ InventoryManager.cs
‚îÇ   ‚îú‚îÄ‚îÄ InventoryItem.cs (SO)
‚îÇ   ‚îú‚îÄ‚îÄ DragDropHandler.cs
‚îÇ   ‚îú‚îÄ‚îÄ ConsumableItem.cs
‚îÇ   ‚îî‚îÄ‚îÄ TemporaryBooster.cs
‚îú‚îÄ‚îÄ Weather/
‚îÇ   ‚îú‚îÄ‚îÄ WeatherSystem.cs
‚îÇ   ‚îú‚îÄ‚îÄ WeatherEffect.cs
‚îÇ   ‚îú‚îÄ‚îÄ WeatherVisuals.cs
‚îÇ   ‚îî‚îÄ‚îÄ SeasonalSystem.cs
‚îú‚îÄ‚îÄ Events/
‚îÇ   ‚îú‚îÄ‚îÄ RandomEventManager.cs
‚îÇ   ‚îú‚îÄ‚îÄ EventData.cs (SO)
‚îÇ   ‚îú‚îÄ‚îÄ EventTrigger.cs
‚îÇ   ‚îî‚îÄ‚îÄ EventNPC.cs
‚îú‚îÄ‚îÄ Zones/
‚îÇ   ‚îú‚îÄ‚îÄ SpecializedZone.cs
‚îÇ   ‚îú‚îÄ‚îÄ ZoneDetector.cs
‚îÇ   ‚îî‚îÄ‚îÄ ZoneVisuals.cs
‚îú‚îÄ‚îÄ Market/
‚îÇ   ‚îú‚îÄ‚îÄ MarketSystem.cs
‚îÇ   ‚îú‚îÄ‚îÄ PriceFluctuation.cs
‚îÇ   ‚îî‚îÄ‚îÄ CurrencyManager.cs
‚îî‚îÄ‚îÄ Chicken/
    ‚îú‚îÄ‚îÄ ChickenCustomization.cs
    ‚îî‚îÄ‚îÄ ChickenUpgrade.cs (SO)

ORDEN DE IMPLEMENTACI√ìN SUGERIDO

FASE 3A: Decoraciones y Boosters (2-3 semanas)
1. Sistema de decoraciones degradables (pasivas + activas)
2. Sistema de inventario drag & drop
3. Consumibles temporales (alimentos, mejoras agua)
4. UI de inventario con tabs

FASE 3B: Sistemas Ambientales (1-2 semanas)
5. Sistema de clima din√°mico
6. Sistema de eventos aleatorios
7. Ciclos estacionales
8. Zonas especializadas

FASE 3C: Econom√≠a Avanzada (1 semana)
9. Mercado din√°mico
10. Sistema de monedas duales
11. Personalizaci√≥n de gallinas

CRITERIOS DE √âXITO FASE 3

‚úÖ Loop auto-sostenible: Granja funciona indefinidamente AFK
‚úÖ Jugador acelera x10: Intervenci√≥n multiplica eficiencia
‚úÖ Sink de huevos: Decoraciones/boosters consumen producci√≥n
‚úÖ Profundidad contemplativa: M√∫ltiples sistemas opcionales
‚úÖ Balance econ√≥mico: Siempre positivo sin jugador
‚úÖ Personalizaci√≥n: Jugador puede customizar granja y gallinas

CONCLUSI√ìN FASE 3

Los sistemas de profundidad auto-sostenible transforman "Gallinas Felices" de un MVP funcional a un idle game completo con horas de contenido contemplativo. El jugador nunca es necesario, pero siempre es bienvenido para acelerar y personalizar su experiencia. La arquitectura modular existente permite implementar estos sistemas sin refactoring mayor, manteniendo los principios KISS/YAGNI.